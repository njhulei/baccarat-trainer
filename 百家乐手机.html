<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>EZ Baccarat Trainer â€” Final</title>
<style>
  body { font-family: "Segoe UI", Roboto, Arial; background:#003a2e; color:#fff; margin:0; padding:12px; text-align:center; }
  h1 { margin:6px 0 10px; font-size:20px; }
  .table { background:#005947; border-radius:12px; padding:10px; margin:8px auto; width:96%; max-width:420px; box-shadow:0 4px 8px rgba(0,0,0,0.4); }
  .score { font-size:15px; margin:6px 0; color:#e0f2f1; }
  .hand { display:flex; justify-content:center; gap:6px; flex-wrap:wrap; padding:6px 0; }
  .card { width:48px; height:66px; background:#fff; color:#000; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:0 2px 4px rgba(0,0,0,0.3); font-size:18px; }
  .controls { margin-top:10px; display:flex; flex-direction:column; gap:8px; align-items:center; }
  .row { display:flex; gap:8px; width:100%; justify-content:center; flex-wrap:wrap; }
  .btn { background:#ffd54f; color:#000; border:none; border-radius:10px; padding:10px 14px; font-weight:700; font-size:15px; min-width:120px; }
  .small { min-width:86px; padding:8px 10px; font-size:14px; }
  #message { margin-top:10px; min-height:42px; font-size:16px; font-weight:700; }
  #nextRound { margin-top:8px; }
  .hint { font-size:12px; color:#b2dfdb; margin-top:6px; }
  footer { font-size:11px; color:#9be7c4; margin-top:12px; }
</style>
</head>
<body>
  <h1>EZ Baccarat Trainer â€” Final</h1>

  <div class="table">
    <div class="score" id="pscore">Player: 0 ï¼ˆK/Q/J/10 = 0ï¼‰</div>
    <div id="player" class="hand"></div>

    <div class="score" id="bscore">Banker: 0</div>
    <div id="banker" class="hand"></div>
  </div>

  <div class="controls">
    <div class="row">
      <button id="dealBtn" class="btn">ğŸ´ Deal</button>
    </div>

    <div class="row">
      <button id="playerDrawBtn" class="btn small">Player Draw 3rd</button>
      <button id="playerNoDrawBtn" class="btn small">Player No Draw</button>
    </div>

    <div class="row">
      <button id="bankerDrawBtn" class="btn small">Banker Draw 3rd</button>
      <button id="bankerNoDrawBtn" class="btn small">Banker No Draw</button>
    </div>

    <div class="row">
      <button id="playerWinBtn" class="btn small">Player Wins</button>
      <button id="bankerWinBtn" class="btn small">Banker Wins</button>
      <button id="tieBtn" class="btn small">Tie</button>
    </div>

    <div class="row">
      <button id="pandaBtn" class="btn small">ğŸ¼ Panda 8</button>
      <button id="dragonBtn" class="btn small">ğŸ‰ Dragon 7</button>
    </div>

    <div id="nextRound" class="row"></div>

    <div id="message"></div>
    <div class="hint">æµç¨‹ï¼šDeal â†’ ï¼ˆè‹¥åŒæ–¹ä¸¤å¼ ä¸”æ—  Naturalï¼‰Player å†³å®š â†’ Banker å†³å®š â†’ Judge</div>
  </div>

  <footer>8-deck shoe æ¨¡æ‹Ÿï¼ˆæ›´æ¥è¿‘çœŸå®èµŒåœºï¼‰ã€‚ç¨‹åºä»…ç”¨äºç»ƒä¹ åˆ¤æ–­ï¼Œä¸å¤„ç†ç­¹ç /æ”¯ä»˜ç»†èŠ‚ã€‚</footer>

<script>
/* ---------- çŠ¶æ€ä¸ç‰Œå † ---------- */
let deck = [], player = [], banker = [];
let state = 'idle'; // 'idle' | 'playerDecision' | 'bankerDecision' | 'finished'
let playerDrew=false, bankerDrew=false;

/* ç”Ÿæˆ 8 å‰¯ç‰Œçš„ shoeï¼ˆæ›´è´´è¿‘èµŒåœºï¼‰ */
function createDeck(){
  deck = [];
  const suits = ['â™ ','â™¥','â™¦','â™£'];
  const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  for(let d=0; d<8; d++){
    for(let s of suits){
      for(let r of ranks){
        deck.push(r + s);
      }
    }
  }
  // æ´—ç‰Œ
  for(let i=deck.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [deck[i], deck[j]]=[deck[j], deck[i]];
  }
}

/* ç‰Œç‚¹å€¼ä¸ç‚¹æ•° */
function cardValue(card){
  const r = card.slice(0, -1);
  if(r === 'A') return 1;
  if(r === '10' || r === 'J' || r === 'Q' || r === 'K') return 0;
  return parseInt(r);
}
function pointsOf(hand){
  return hand.reduce((s,c)=>s+cardValue(c),0) % 10;
}

/* UI æ¸²æŸ“ */
function renderHands(){
  document.getElementById('player').innerHTML = player.map(c=>`<div class="card">${c}</div>`).join('');
  document.getElementById('banker').innerHTML = banker.map(c=>`<div class="card">${c}</div>`).join('');
  document.getElementById('pscore').textContent = `Player: ${pointsOf(player)} ï¼ˆK/Q/J/10 = 0ï¼‰`;
  document.getElementById('bscore').textContent = `Banker: ${pointsOf(banker)}`;
}

/* æŒ‰é’®å¯ç”¨æ€§æ§åˆ¶ */
function setDecisionBtns(enabledPlayer, enabledBanker){
  document.getElementById('playerDrawBtn').disabled = !enabledPlayer;
  document.getElementById('playerNoDrawBtn').disabled = !enabledPlayer;
  document.getElementById('bankerDrawBtn').disabled = !enabledBanker;
  document.getElementById('bankerNoDrawBtn').disabled = !enabledBanker;
}

/* é‡ç½® Next Round åŒºåŸŸ */
function clearNextRound(){
  document.getElementById('nextRound').innerHTML = '';
}

/* ---------- æ ¸å¿ƒæµç¨‹å‡½æ•° ---------- */

/* å‘ç‰Œï¼ˆDealï¼‰ */
function deal(){
  // å¦‚æœç‰Œä¸å¤Ÿåˆ™é‡æ´—ï¼ˆé¿å…ç©ºç‰Œå †ï¼‰
  if(deck.length < 12) createDeck();
  player = [deck.pop(), deck.pop()];
  banker = [deck.pop(), deck.pop()];
  playerDrew=false;
  bankerDrew=false;
  state = 'playerDecision';
  renderHands();
  clearNextRound();

  // Natural åªåœ¨åŒæ–¹ä¸¤å¼ ç‰Œæ—¶ç”Ÿæ•ˆ
  const p = pointsOf(player), b = pointsOf(banker);
  if(player.length===2 && banker.length===2 && (p >= 8 || b >= 8)){
    state = 'finished';
    document.getElementById('message').textContent = `Natural! Player ${p} â€” Banker ${b} â†’ No draws.`;
    setDecisionBtns(false, false);
    // è‡ªåŠ¨æ˜¾ç¤º Next Round
    document.getElementById('nextRound').innerHTML = `<button class="btn" onclick="deal()">â¡ï¸ Next Round</button>`;
    return;
  }

  document.getElementById('message').textContent = `Player ${p} â€” Banker ${b} â†’ Decide if Player draws (3rd card).`;
  // å¯ç”¨ Player å†³ç­–æŒ‰é’®ï¼Œç¦ç”¨ Bankerï¼ˆå¿…é¡»å…ˆåš Player å†³å®šï¼‰
  setDecisionBtns(true, false);
}

/* Player å†³ç­–ï¼šDraw / No Drawï¼ˆç”¨æˆ·è§¦å‘ï¼‰ */
function playerDrawDecision(shouldDraw){
  if(state !== 'playerDecision'){
    document.getElementById('message').textContent = 'å½“å‰ä¸åœ¨ Player å†³ç­–é˜¶æ®µã€‚';
    return;
  }

  // Natural å†æ£€ä¸€æ¬¡ï¼ˆä¸¥æ ¼ï¼‰
  if(player.length===2 && banker.length===2 && (pointsOf(player)>=8 || pointsOf(banker)>=8)){
    document.getElementById('message').textContent = 'Natural occurred â€” no draw allowed.';
    state='finished';
    setDecisionBtns(false,false);
    document.getElementById('nextRound').innerHTML = `<button class="btn" onclick="deal()">â¡ï¸ Next Round</button>`;
    return;
  }

  const playerPts = pointsOf(player);

  if(shouldDraw){
    // éªŒè¯è§„åˆ™ï¼šPlayer <=5 æ‰åº” draw
    if(playerPts <= 5){
      // æ­£ç¡®ï¼šæ‰§è¡Œ draw
      if(deck.length === 0) createDeck();
      player.push(deck.pop());
      playerDrew = true;
      renderHands();
      document.getElementById('message').textContent = `Player draws correctly. Player now ${pointsOf(player)}. Now Banker decision.`;
    } else {
      // é”™è¯¯ï¼šæç¤ºå¹¶**ä¸æ‰§è¡Œ**æŠ½ç‰Œ
      document.getElementById('message').textContent = `âŒ é”™è¯¯ï¼šPlayer åº”è¯¥ä¸æŠ½ï¼ˆPlayer ${playerPts}ï¼‰ã€‚æœªæŠ½å–ã€‚ç°åœ¨ Banker å†³ç­–ã€‚`;
      playerDrew = false;
    }
  } else {
    // ç”¨æˆ·é€‰ No Drawï¼šéªŒè¯æ˜¯å¦æ­£ç¡®
    if(playerPts <= 5){
      // æœ¬åº”æŠ½ï¼Œç”¨æˆ·é€‰æ‹©ä¸æŠ½ â€”â€” æ ‡è®°é”™è¯¯
      document.getElementById('message').textContent = `âŒ é”™è¯¯ï¼šPlayer åº”è¯¥æŠ½ï¼ˆPlayer ${playerPts}ï¼‰ï¼Œä½ é€‰æ‹©äº†ä¸æŠ½ã€‚ç°åœ¨ Banker å†³ç­–ã€‚`;
      playerDrew = false;
    } else {
      document.getElementById('message').textContent = `æ­£ç¡®ï¼šPlayer ä¸æŠ½ï¼ˆPlayer ${playerPts}ï¼‰ã€‚ç°åœ¨ Banker å†³ç­–ã€‚`;
      playerDrew = false;
    }
  }

  // è½¬å…¥ Banker å†³ç­–é˜¶æ®µ
  state = 'bankerDecision';
  setDecisionBtns(false, true);
}

/* Banker å†³ç­–ï¼šDraw / No Drawï¼ˆç”¨æˆ·è§¦å‘ï¼‰ */
function bankerShouldDrawByRules(){
  // æ ¹æ® EZ Baccarat Banker Draw è¡¨ï¼šå¿…é¡»è€ƒè™‘æ˜¯å¦ Player æœ‰ç¬¬ä¸‰å¼ ç‰Œ
  const b = pointsOf(banker);
  // If Player did not draw
  if(!playerDrew){
    return b <= 5;
  }
  // Player drew: look at player's third card
  const third = cardValue(player[2]); // safe because playerDrew==true and card exists
  if(b <= 2) return true;
  if(b === 3) return third !== 8;
  if(b === 4) return [2,3,4,5,6,7].includes(third);
  if(b === 5) return [4,5,6,7].includes(third);
  if(b === 6) return [6,7].includes(third);
  return false;
}

function bankerDrawDecision(shouldDraw){
  if(state !== 'bankerDecision'){
    document.getElementById('message').textContent = 'å½“å‰ä¸åœ¨ Banker å†³ç­–é˜¶æ®µã€‚';
    return;
  }

  const bPts = pointsOf(banker);

  // If natural occurred earlier and state changed, protect
  if(player.length===2 && banker.length===2 && (pointsOf(player)>=8 || pointsOf(banker)>=8)){
    document.getElementById('message').textContent = 'Natural occurred â€” no draw allowed.';
    state='finished';
    setDecisionBtns(false,false);
    document.getElementById('nextRound').innerHTML = `<button class="btn" onclick="deal()">â¡ï¸ Next Round</button>`;
    return;
  }

  const shouldBankerDrawByRules = bankerShouldDrawByRules();

  if(shouldDraw){
    if(shouldBankerDrawByRules){
      if(deck.length === 0) createDeck();
      banker.push(deck.pop());
      bankerDrew = true;
      renderHands();
      document.getElementById('message').textContent = `Banker draws correctly. Banker now ${pointsOf(banker)}. Round finished.`;
    } else {
      // ç”¨æˆ·é”™è¯¯å°è¯•æŠ½ç‰Œï¼Œæç¤ºå¹¶ä¸æŠ½
      document.getElementById('message').textContent = `âŒ é”™è¯¯ï¼šBanker ä¸åº”æŠ½ï¼ˆBanker ${bPts}ï¼‰ã€‚æœªæŠ½ã€‚Round finished.`;
      bankerDrew = false;
    }
  } else {
    // ç”¨æˆ·é€‰æ‹©ä¸æŠ½ï¼šéªŒè¯æ˜¯å¦æ­£ç¡®
    if(shouldBankerDrawByRules){
      document.getElementById('message').textContent = `âŒ é”™è¯¯ï¼šBanker åº”è¯¥æŠ½ï¼ˆBanker ${bPts}ï¼‰ï¼Œä½ é€‰æ‹©äº†ä¸æŠ½ã€‚Round finished.`;
      bankerDrew = false;
    } else {
      document.getElementById('message').textContent = `æ­£ç¡®ï¼šBanker ä¸æŠ½ï¼ˆBanker ${bPts}ï¼‰ã€‚Round finished.`;
      bankerDrew = false;
    }
  }

  // è¿›å…¥ finished çŠ¶æ€
  state = 'finished';
  setDecisionBtns(false,false);

  // æ˜¾ç¤º Next Round æŒ‰é’®
  document.getElementById('nextRound').innerHTML = `<button class="btn" onclick="deal()">â¡ï¸ Next Round</button>`;
}

/* Judge / Guess æŒ‰é’®å¤„ç†ï¼ˆç”¨æˆ·é€‰æ‹©è°èµ¢æˆ– Panda/Dragonï¼‰ */
function judge(choice){
  if(state !== 'finished'){
    document.getElementById('message').textContent = 'è¯·å…ˆå®Œæˆ Player/Banker çš„å†³ç­–ï¼ˆæˆ–ç­‰å¾…è‡ªåŠ¨ Natural ç»“æŸï¼‰ã€‚';
    return;
  }

  const p = pointsOf(player), b = pointsOf(banker);
  let correct = '';
  const playerWin = p > b;
  const bankerWin = b > p;

  // åŸºæœ¬èƒœè´Ÿ
  if(playerWin) correct = 'player';
  else if(bankerWin) correct = 'banker';
  else correct = 'tie';

  // Panda/Dragon åªæœ‰åœ¨ç›¸åº”ä¸€æ–¹å·²æŠ½ç¬¬ä¸‰å¼ å¹¶ä¸”æœ€ç»ˆèµ¢æ—¶æœ‰æ•ˆ
  if(playerDrew && p === 8 && playerWin) correct = 'panda';
  if(bankerDrew && b === 7 && bankerWin) correct = 'dragon';

  let msg = '';
  if(choice === correct){
    msg = 'âœ… æ­£ç¡®ï¼ ';
  } else {
    msg = 'âŒ é”™è¯¯ï¼ ';
  }

  if(correct === 'player') msg += `Player wins (${p} v ${b}).`;
  else if(correct === 'banker') msg += `Banker wins (${b} v ${p}).`;
  else if(correct === 'tie') msg += `Tie (${p} v ${b}).`;
  else if(correct === 'panda') msg += `ğŸ¼ Panda 8 â€” Player drew 3rd and won with 8.`;
  else if(correct === 'dragon') msg += `ğŸ‰ Dragon 7 â€” Banker drew 3rd and won with 7.`;

  document.getElementById('message').textContent = msg;
}

/* åˆå§‹åŒ– / äº‹ä»¶ç»‘å®š */
function resetAll(){
  createDeck();
  player = []; banker = [];
  state = 'idle';
  playerDrew=false; bankerDrew=false;
  renderHands();
  document.getElementById('message').textContent = 'å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡» Deal å¼€å±€ã€‚';
  setDecisionBtns(false, false);
  clearNextRound();
}

/* ç»‘å®šUI */
document.getElementById('dealBtn').addEventListener('click', deal);
document.getElementById('playerDrawBtn').addEventListener('click', ()=>playerDrawDecision(true));
document.getElementById('playerNoDrawBtn').addEventListener('click', ()=>playerDrawDecision(false));
document.getElementById('bankerDrawBtn').addEventListener('click', ()=>bankerDrawDecision(true));
document.getElementById('bankerNoDrawBtn').addEventListener('click', ()=>bankerDrawDecision(false));
document.getElementById('playerWinBtn').addEventListener('click', ()=>judge('player'));
document.getElementById('bankerWinBtn').addEventListener('click', ()=>judge('banker'));
document.getElementById('tieBtn').addEventListener('click', ()=>judge('tie'));
document.getElementById('pandaBtn').addEventListener('click', ()=>judge('panda'));
document.getElementById('dragonBtn').addEventListener('click', ()=>judge('dragon'));

window.addEventListener('load', resetAll);
</script>
</body>
</html>

